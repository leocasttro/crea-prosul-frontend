<div class="search-container">
  <div class="professional-search">
    <h2>Consulta de Profissionais</h2>

    <div class="selection-container">
      <div
        *ngFor="let selection of selectedProfessionals; let i = index; trackBy: trackByIndex"
        class="selection-row"
        [class.even-row]="i % 2 === 0"
        [class.odd-row]="i % 2 !== 0"
      >
        <div class="grid-container">
          <!-- Linha 1: Três colunas (Profissional, Serviço Técnico, Código) -->
          <div class="grid-row">
            <div class="form-group grid-item">
              <label for="professional-{{ i }}">Profissional {{ i + 1 }}</label>
              <ng-select
                [items]="professionals"
                bindLabel="name"
                [(ngModel)]="selection.professional"
                placeholder="Selecione um profissional"
                (ngModelChange)="onProfessionalChange(selection)"
              ></ng-select>
            </div>
            <div class="form-group grid-item" *ngIf="selection.professional">
              <label for="service-{{ i }}">Serviço Técnico</label>
              <ng-select
                [items]="selection.technicalServices"
                bindLabel="nomeServicoTecnico"
                bindValue="codigoServicoTecnico"
                [(ngModel)]="selection.service"
                (ngModelChange)="onServiceChange(selection)"
              ></ng-select>
            </div>
            <div class="form-group code-display grid-item" *ngIf="selection.service">
              <label>Código do Serviço Técnico</label>
              <span>{{ selection.service }}</span>
            </div>
          </div>

          <!-- Linha 2: Seções expansivas (Atividades, Códigos, Quantidade, Unidade, Botão) -->
          <div class="grid-row full-width">
            <div class="form-group grid-item activities" *ngIf="selection.service">
              <label for="activity-{{ i }}">Atividades</label>
              <ng-select
                [items]="selection.activities"
                bindLabel="name"
                bindValue="id"
                [multiple]="true"
                [(ngModel)]="selection.activityIds"
                placeholder="Selecione atividades"
              ></ng-select>
            </div>
            <div class="form-group code-display grid-item activity-codes" *ngIf="selection.activityIds?.length">
              <label>Códigos das Atividades</label>
              <span>{{ getActivityCodes(selection) }}</span>
            </div>
            <div class="form-group grid-item quantity" *ngIf="selection.activityIds?.length">
              <label for="quantity-{{ i }}">Quantidade</label>
              <input
                type="number"
                id="quantity-{{ i }}"
                [(ngModel)]="selection.quantity"
                min="1"
                step="1"
                placeholder="Digite a quantidade"
              />
            </div>
            <div class="form-group grid-item" *ngIf="selection.activityIds?.length">
              <label for="unit-{{ i }}">Unidade de Medida</label>
              <input
                type="text"
                id="unit-{{ i }}"
                [(ngModel)]="selection.unit"
                placeholder="Digite a unidade de medida"
              />
            </div>
            <button
              class="remove-btn grid-item"
              (click)="removeSelection(i)"
              *ngIf="selection.service"
              title="Remover seleção"
            >
              ×
            </button>
          </div>
        </div>
        <div class="button-container">
          <button
            class="add-professional-btn"
            (click)="addProfessionalSelection()"
          >
            + Adicionar Profissional
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
